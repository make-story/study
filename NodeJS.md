# `Node.js 교과서` 책 정리

# 예외 처리하기
노드에서는 예외처리가 정말 중요합니다.  
예외란 보통 처리하지 못한 에러를 가리킵니다. 이러한 예외들은 실행 중인 노드 프로세스를 멈추게 만듭니다.  
멀티 스레드 프로그램에서는 스레드 하나가 멈추면 그 일을 다른 스레드가 대신합니다. 하지만 노드의 메인 스레드는 하나뿐이므로 그 하나를 소중히 보호해야 합니다.  
메인 스레드가 에러로 인해 멈춘다는 것은 스레드를 갖고 있는 프로세스가 멈춘다는 뜻이고, 전체 서버도 멈춘다는 뜻과 같습니다.  
아무리 신중을 가해 만들었다고 해도 항상 얘기치 못한 에러는 발생하는 법입니다.  

프로세스가 멈추지 않도록 에러를 찾는 것은,  
에러가 발생할 것 같은 부분을 `try / catch`문으로 감싸면 됩니다.  

```javascript
setInterval(() => {
    console.log('시작');
    try {
        throw new Error('서버를 고장내주마!');
    }catch(err) {
        console.error(err);
    }
}, 1000);
```
setInterval 을 사용한 것은 프로세스가 멈추는지 여부를 체크하기 위해서 입니다.  
프로세스가 에러로 인해 멈추면 setInverval 도 멈출 것입니다.  
setInterval 내부에 throw new Error()를 써서 에러를 강제로 발생시켰습니다.  

위 코드를 실행시키면,  
에러는 발생하지만 try / catch 로 잡을 수 있고 setInterval도 직접 멈추기 전(Ctrl+C)까지 계속 실행됩니다.
`이렇게 에러가 발생할 것 같은 부분을 try / catch로 감싸면 됩니다.`  
`throw 만하면 노드 프로세스가 멈춰버립니다. 따라서 throw 를 하는 경우에는 반드시 try / catch 문으로 throw 한 에러를 잡아야 합니다.`  

프로미스의 에러는 catch 하지 않아도 알아서 처리됩니다.  
다만 프로미스의 에러를 알아서 처리하는 동작은 노드 버전이 올라감에 따라 바뀔 수 있습니다.  
따라서 `프로미스를 사용할 때는 항상 catch 를 붙여주는 것을 권장`합니다.  

`process 객체에 uncaughtException 이벤트`가 있습니다.  
처리하지 못한 에러가 발생 했을 때 이벤트 리스너가 실행되고 프로세스가 유지됩니다.  
```javascript
process.on('uncaughtException', (error) => {
	console.log('예기치 못한 에러', error);
});

// 실행 후 1초만에 throw 에러가 발생하며 프로세스가 멈출 것 같지만,
// uncaughtException 이벤트 리스너가 연결되어 있으므로 프로세스가 멈추지 않습니다.  
setInterval(() => {
    throw new Error('throw 를 사용해 서버를 멈추게 해본다!!!!');
}, 1000);
setTimeout(() => {
    console.log('실행됩니다!');
}, 2000);
```

노드 공식 문서에서는 uncaughtException 이벤트를 최후의 수단으로 사용할 것을 명시하고 있습니다.    
노드는 uncaughtException 이벤트 발생 후 다음 동작이 제대로 동작하는지를 보증하지 않습니다. 즉, 복구 작업 코드를 넣어 두었더라도 그것이 동작하는지 확신할 수 없습니다.   
따라서 uncaughtException 은 단순히 에러 내용을 기록하는 정도로 사용하고, 에러를 기록한 후 process.exit()으로 프로세스를 종료하는 것이 좋습니다.  
에러가 발새앟는 코드를 수정하지 않는 이상, 프로세스가 실행되는 동안 에러는 계속 발생할 것입니다.  

-----

# `한권으로 끝내는 Node & Express` 책 정리

# 스캐폴딩 
p53  


# 모범사례
p68  


# 요청 / 응답 헤더  
## 인터넷 미디어 타입  
p107

## 요청 객체
p108

## 응답 객체
p110  


# 서버 사이트 템플릿
p130 


# 쿠키 세션
p157  

## 자격 증명 위임
p159  


# 미들웨어
p171  

## 미들웨어 원칙 
p172  



# 앱 클러스터를 통한 스케일 아웃



# 지속성
p213  



# 라우팅
p245  


# 보안
## 인증서 직접 생성  
p308 




