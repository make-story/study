# MySQL Master-Slave Replication

https://www.blog.ecsimsw.com/entry/Mysql-DB-Replication-%EC%9C%BC%EB%A1%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B0%B1%EC%97%85-%EC%BF%BC%EB%A6%AC-%EB%B6%84%EC%82%B0

## Replication 종류

Mysql 의 복제 방식은 '동기', '비동기', '반동기'가 대표적이다.

동기 방식은  
한 노드에 요청된 쿼리를 트랜잭션 내에서 다른 노드들에 전달하고 모든 노드들이 동기화되면 트랜잭션의 결과를 반환한다.  
마스터(또는 첫 요청을 받은 노드)가 다른 노드들에 쿼리를 전달하는 식으로 진행된다.

모든 노드에서 동일한 요청을 수행한 후 결과를 반환하기에 모든 노드에 데이터 정합성이 보장된다는 장점이 있으나, 그렇기 때문에 애플리케이션 쪽에선 DB 처리 속도가 느려지고 트랜잭션의 생명주기가 길어진다는 단점이 있다. 또 노드 중 하나라도 에러나 다른 상태를 갖게된다면 모든 노드가 결국 요청을 못 다루는 상황이 생기게 된다.

비동기 방식은  
한 노드에 요청된 쿼리를 다른 노드에서 읽어서 처리한다. Mysql 의 경우 수행된 쿼리나 변경 값을 로그로 (바이너리 로그) 저장하고 master thread 에서 , slave 에선 그 내용을 기록해두었다가 (릴레이로그) slave thread 로 읽어 본인의 data 에도 이를 반영하는 식으로 진행된다. 애플리케이션 입장에선 Master 노드의 처리만 기다리면 되기 때문에 속도에서 이점이 있으나, slave 에서 sync 처리를 반영하는 사이 시간 동안 데이터 정합성이 깨지는 단점이 있다.

반동기 방식은 이 둘을 섞는다.  
Master 가 요청된 요청을 Binary log 에 저장하고 slave 는 이 log 를 읽고 처리가 완료되면 master node 에 ACK 로 알린다. Master 는 한 개 이상의 ACK 를 확인하면 그제서야 트랜잭션을 커밋한다.

이렇게 하면 모든 Node 를 기다리지 않되 한 개의 slave 는 데이터 정합성을 유지한다는 것이 보장되게 된다. 그렇지만 여전히 비동기 방식보다 느리고, slave 의 상태나 네트워크에 영향을 받는다는 단점이 있다.
