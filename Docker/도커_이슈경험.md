# '=> ERROR [internal] load metadata for docker.io/library/node:17-alpine3.14'

docker config 파일 삭제

```
$ rm ~/.docker/config.json
```

# supervisor - apk 인증서 문제 (SSL routines:tls process server certificate:certificate verify failed:ssl/statem/statem)

```
 > [build 6/9] RUN apk add supervisor:
#0 0.161 fetch https://dl-cdn.alpinelinux.org/alpine/v3.14/main/aarch64/APKINDEX.tar.gz
#0 0.252 281473639570504:error:1416F086:SSL routines:tls_process_server_certificate:certificate verify failed:ssl/statem/statem_clnt.c:1914:
#0 0.252 ERROR: https://dl-cdn.alpinelinux.org/alpine/v3.14/main: Permission deniedfetch https://dl-cdn.alpinelinux.org/alpine/v3.14/community/aarch64/APKINDEX.tar.gz
#0 0.252
#0 0.252 WARNING: Ignoring https://dl-cdn.alpinelinux.org/alpine/v3.14/main: No such file or directory
#0 0.308 281473639570504:error:1416F086:SSL routines:tls_process_server_certificate:certificate verify failed:ssl/statem/statem_clnt.c:1914:
#0 0.309 ERROR: https://dl-cdn.alpinelinux.org/alpine/v3.14/community: Permission denied
#0 0.309 WARNING: Ignoring https://dl-cdn.alpinelinux.org/alpine/v3.14/community: No such file or directory
#0 0.310   supervisor (no such package):
#0 0.310     required by: world[supervisor]
#0 0.310 ERROR: unable to select packages:
```

임시 방편으로 Docker 파일에
`sed 's/https/http/g' -i /etc/apk/repositories` 추가

```Dockerfile
RUN sed 's/https/http/g' -i /etc/apk/repositories
...
RUN apk add supervisor
```

# exec user process caused: exec format error

Docker Buildx 를 통한 Multi-architecture 이미지 빌드

https://kimjingo.tistory.com/221

https://kimjingo.tistory.com/115

# node::WorkerThreadsTaskRunner

```
node[6]: ../src/node_platform.cc:68:std::unique_ptr<long unsigned int> node::WorkerThreadsTaskRunner::DelayedTaskScheduler::Start(): Assertion `(0) == (uv_thread_create(t.get(), start_thread, this))' failed.
 1: 0xc99970 node::Abort() [node]
 2: 0xc999ee  [node]
 3: 0xd19899 node::WorkerThreadsTaskRunner::WorkerThreadsTaskRunner(int) [node]
 4: 0xd199bc node::NodePlatform::NodePlatform(int, v8::TracingController*, v8::PageAllocator*) [node]
 5: 0xc53c23  [node]
 6: 0xc545b4 node::Start(int, char**) [node]
 7: 0x7fa8d1ddcd90  [/lib/x86_64-linux-gnu/libc.so.6]
 8: 0x7fa8d1ddce40 __libc_start_main [/lib/x86_64-linux-gnu/libc.so.6]
 9: 0xbb0c7e _start [node]
```

## 1.

https://github.com/nodejs/node/issues/43064

```
ulimit -u 1024
```

## 2.

https://stackoverflow.com/questions/52418677/docker-build-ulimit-flag-has-no-effect

```
export DOCKER_BUILDKIT=1
```

```
export DOCKER_BUILDKIT=0
```

## 3.

`https://github.com/nodejs/node/issues/48444#issuecomment-1592984563`

```
root@test-digitalocean-ubuntu1804-docker-x64-1:~# docker run -it node:20.3.0 node
Unable to find image 'node:20.3.0' locally
20.3.0: Pulling from library/node
bba7bb10d5ba: Pull complete
ec2b820b8e87: Pull complete
284f2345db05: Pull complete
fea23129f080: Pull complete
9063cd8e3106: Pull complete
4b4424ee38d8: Pull complete
0b4eb4cbb822: Pull complete
43443b026dcf: Pull complete
Digest: sha256:fc738db1cbb81214be1719436605e9d7d84746e5eaf0629762aeba114aa0c28d
Status: Downloaded newer image for node:20.3.0
Welcome to Node.js v20.3.0.
Type ".help" for more information.
>
```

```
root@infra-digitalocean-ubuntu1604-x64-1:~# docker run -it node:20.3.0 node
Unable to find image 'node:20.3.0' locally
20.3.0: Pulling from library/node
bba7bb10d5ba: Pull complete
ec2b820b8e87: Pull complete
284f2345db05: Pull complete
fea23129f080: Pull complete
9063cd8e3106: Pull complete
4b4424ee38d8: Pull complete
0b4eb4cbb822: Pull complete
43443b026dcf: Pull complete
Digest: sha256:fc738db1cbb81214be1719436605e9d7d84746e5eaf0629762aeba114aa0c28d
Status: Downloaded newer image for node:20.3.0
node[1]: ../src/node_platform.cc:68:std::unique_ptr<long unsigned int> node::WorkerThreadsTaskRunner::DelayedTaskScheduler::Start(): Assertion `(0) == (uv_thread_create(t.get(), start_thread, this))' failed.
 1: 0xc8e4a0 node::Abort() [node]
 2: 0xc8e51e  [node]
 3: 0xd0a059 node::WorkerThreadsTaskRunner::WorkerThreadsTaskRunner(int) [node]
 4: 0xd0a17c node::NodePlatform::NodePlatform(int, v8::TracingController*, v8::PageAllocator*) [node]
 5: 0xc4bbc4 node::V8Platform::Initialize(int) [node]
 6: 0xc49408  [node]
 7: 0xc497db node::Start(int, char**) [node]
 8: 0x7f6e8486218a  [/lib/x86_64-linux-gnu/libc.so.6]
 9: 0x7f6e84862245 __libc_start_main [/lib/x86_64-linux-gnu/libc.so.6]
10: 0xba9ade _start [node]

# ----------

root@infra-digitalocean-ubuntu1604-x64-1:~# docker run -it node:20.3.0-bullseye node
Unable to find image 'node:20.3.0-bullseye' locally
20.3.0-bullseye: Pulling from library/node
93c2d578e421: Already exists
c87e6f3487e1: Already exists
65b4d59f9aba: Already exists
d7edca23d42b: Already exists
25c206b29ffe: Already exists
599134452287: Pull complete
bd8a83c4c2aa: Pull complete
d11f4613ae42: Pull complete
Digest: sha256:ceb28814a32b676bf4f6607e036944adbdb6ba7005214134deb657500b26f0d0
Status: Downloaded newer image for node:20.3.0-bullseye
Welcome to Node.js v20.3.0.
Type ".help" for more information.
>
```
