# package-lock.json

https://docs.npmjs.com/cli/configuring-npm/package-lock-json

Yarn 의 등장과 함께 동일한 버전 관리를 위한 패키지 잠금파일(Lock 파일) 지원  
NPM 에서도 `npm v5.0 에 package-lock.json 이라는 새로운 패키지가 등장`

노드 패키지 간의 의존 관계를 고정시켜둔 파일

- npm 패키지를 설치하거나 수정, 삭제 등의 작업을 진행할 때 생성
- 패키지(모듈)내 다른 모듈의 의존성등 각 패키지에 대한 의존성 관리
- 하나의 패키지를 여러 패키지에서 사용할 수 있고 하나의 패키지는 여러 개의 버전을 가지며 또 이 여러 버전을 다른 패키지에서 사용할 수 있음.
- 이렇게 되면 패키지 버전 간의 충돌과 호환이 되지 않는 경우가 있는데 이를 미연에 방지하기 위한 것
- 하나의 패키지에 dependencies(종속)가 어떤 패키지인지 버전 정보와 이름이 나열되어 있고 dependencies에 명시된 특정 패키지를 - 다시 검색 및 추적하다 보면 여러 패키지에서 사용하는 것을 볼 수 있음

## 패키지 잠금 파일 (package-lock.json, yarn.lock)

https://www.daleseo.com/js-package-locks/

react 패키지가 "react": "^16.8.2"이라고 등록되어 있으면,  
SemVer 규칙에 따라 16.8.2 이상 17.0.0 미만의 범위로 버전이 지정됩니다.

맨 처음 프로젝트에 react 패키지를 설치한 개발자 A가 특정 버전을 지정하지 않았다고 가정하면, 당시 react 패키지의 최신 버전은 16.8.2 였을 것입니다.  
만약에 추후 개발자 B가 npm i나 yarn 명령어를 통해 모든 패키지를 설치할 당시 react 패키지의 최신 버전이 16.8.3이였다면 개발자 B의 PC에는 16.8.3이 설치되어 있을 것입니다.  
마찬가지로 프로젝트에 몇달 후에 합류한 개발자 C가 react 패키지의 최신 버전이 16.9.1일 때 같은 방법으로 모든 패키지를 설치했다면, 개발자 C의 PC에는 16.9.1이 설치되었을 것입니다.

- package.json: ^16.8.2
- 개발자 A의 PC: 16.8.2
- 개발자 B의 PC: 16.8.3
- 개발자 C의 PC: 16.9.1
- CI/상용 서버: 16.10.0

이 문제를 해결하기 위해서 먼저 yarn에서 패키지 잠금을 지원하고,  
나중에 npm에서도 패키지 잠금을 지원하게 되었습니다.  
이제 패키지 잠금은 대부분의 패키지 매니저에서 지원하는 필수 기능이 되었습니다.

- https://docs.npmjs.com/cli/v7/configuring-npm/package-lock-json
- https://classic.yarnpkg.com/en/docs/yarn-lock/

## 설치 시점에 따라 달라지는 패키지 버전 (package-lock.json 또는 yarn.lock 파일이 필요한 이유)

`모든 개발자가 정확히 같은 시각 동시에 패키지를 설치하지 않는 이상 개발자들은 서로 상이한 버전의 패키지를 설치할 확률이 발생`  
`가장 큰 이유는 package.json 파일에 등록된 패키지의 버전이 ^나 ~ 등을 이용해서 범위로 지정된 경우가 많기 때문`

예를 들어,  
package.json: ^16.8.2  
개발자 A의 PC: 16.8.2  
개발자 B의 PC: 16.8.3  
개발자 C의 PC: 16.9.1  
개발/상용 서버: 16.10.0

## 패키지 잠금 (작업자 모두 동일한 패키지 버전 사용이 가능)

`package.json 파일을 사용해도 시간과 장소에 따라서 서로 다른 버전의 패키지가 설치되는 문제는 패키지 잠금을 통해 해결`  
`package-lock.json 이나 yarn.lock 과 같은 패키지 잠금 파일에는 프로젝트에 패키지에 최초로 추가될 당시에 정확히 어떤 버전이 설치가 되었는지를 기록`

## 주의 사항

프로젝트를 최초 셋업하는 개발자는 패키지 잠금 파일을 Git 저장소에 반드시 올려서 다른 개발자들이 패키지 잠금 파일을 기준으로 패키지를 설치할 수 있도록 해야 함  
패키지 잠금 파일은 패키지 매니저가 신규 패키지를 설치하거나 기존 패키지를 갱신/제거할 때마다 package.json과 자동으로 동기를 맞춰주기 때문에 개발자가 이 파일을 직접 수정해야 할 필요는 없으며 해서도 안 됨  
신규 패키지를 설치하거나 기존 패키지를 갱신/제거한 개발자는 package.json과 더불어 함께 업데이트된 패키지 잠금 파일을 반드시 커밋
