`함수형 자바스크립트 입문` 책 정리

# 반응형 러이브러리 빌드

## 불변성

- 불변형 (값복사)
  숫자, 문자열 등

- 가변형 (참조복사)
  객체, 배열 등

## 간단한 Redux 라이브러리 빌드

Redux 는 프레임워크에 구애받지 않는 상태 라이브러리이다.  
Redux 는 페이스북에서 도입한 애플리케이션 아키텍처인 플럭스(Flux)에서 영감을 받았다.  
Redux 는 단방향 데이터 흐름을 사용한다.

- 진실의 근원은 하나(Single source of truth)  
  애플리케에션은 중심 상태를 가진다.
- 상태는 읽기 전용이다  
  액션과 같은 특정 이벤트는 상태 변경을 의미한다.
- 변화는 순수 함수로 작성된다.  
  액션은 리듀서(Reducer)에 의해 사용되는데, 액션은 사용자 액션을 식별할 때 호출할 수 있는 순수 함수다. 한 번에 하나의 변경만 일어난다.

`상태`는 본질적으로 읽기만 가능하므로
상태를 변경하는 유일한 방법은 무엇이 있어났는지 설명하는 `액션`을 수행하는 것이다.  
액션은 `리듀서`에 의해 사용되고 새로운 상태가 생성돼 결과적으로 DOM 이 갱신된다.

Redux 이 핵심 요소는 `리듀서`, `액션`, `상태`다.

```javascript
// 상태 선언
let initialState = { counter: 0 };

// 리듀서
// 상태를 변환할 수 이쓴ㄴ 유일한 함수
// 리듀서는 현재 상태와 해당 액션인 두 개의 입력을 가지며, 새로운 상태를 생성한다.
function reducer(state, action) {
  if (action.type === 'INCREMENT') {
    state = Object.assign({}, state, { counter: state.counter + 1 });
  }
  return state;
}

// 스토어(store) 생성 함수
function createStore(reducer, preloadedState) {
  let currentReducer = reducer; // 리듀서
  let currentState = preloadedState; // 상태
  let currentListeners = [];
  let nextListeners = currentListeners;

  // 현재 상태
  function getState() {
    return currentState;
  }

  // 액션 실행
  function dispatch(action) {
    currentState = currentReducer(currentState, action);

    const listeners = (currentListeners = nextListeners);
    for (let i = 0; i < listeners.length; i++) {
      const listener = listeners[i];
      listener();
    }

    return action;
  }

  // 상태변화 구독
  function subscribe(listener) {
    nextListeners.push(listener);
  }

  return {
    getState,
    dispatch,
    subscribe,
  };
}

// 스토어 생성
let store = createStore(reducer, initialState);
function loadRedux() {
  // 초기 상태 화면 렌더
  render(store.getState());
}

// 액션 실행
function incrementCounter() {
  store.dispatch({
    type: 'INCREMENT',
  });
}
document.getElementById('botton').addEventListener('click', function () {
  incrementCounter();
});

// 상태변화 구독
function render(state) {
  document.getElementById('counter').textContent = state.counter;
}
store.subscribe(function () {
  render(store.getState());
});
```

## HyperApp 과 같은 프레임워크 구성

HyperApp 은 불변성, 클로저, 고차 함수 등과 같은 함수형 프로그래밍 개념을 기반으로 한다.

가상 DOM 은 JSON 을 사용해 DOM 을 인메모리로 표현한 것이다.  
DOM 연산은 실제 DOM에 적용하기 전에 인메모리 표현을 해야 한다.  
HyperApp 라이브러리는 가상 DOM 을 사용해 상태 변화를 감지하고, 델타 DOM 만을 다시 작성하므로 애플리케이션의 효율이 전반적으로 향상된다.
