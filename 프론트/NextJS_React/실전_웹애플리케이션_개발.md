`타입스크립트, 리액트, Next.js 로 배우는 실전 웹 애플리케이션 개발` 책 정리

- 타밉스크립트
- 리액트
- Next.js

# p32, Next.js 가 필요해진 이유

Next.js 개발자들의 사상은 클라이언트와 서버 사이에서 코드를 공유할 수 있는 유니버설한 자바스크립트 애플리케이션을 만드는 것입니다.

리액트의 특징인 렌더링 함수와 컴포넌트 라이브 사이클을 활용함으로써 자바스크립트를 사용해 이제까지 보다 효율적으로 애플리케이션을 개발할 수 있는 세계를 구현하고 있습니다.  
또한, Next.js 의 SSR 기능을 활용해 웹 브라우저의 부담을 줄이고, 보안도 강화할 수 있습니다.  
SSR 은 애플리케이션의 모든 부분에 대해, 또는 프로젝트 전체에 대해 수행할 수 있으며, `콘텐츠가 풍부한 페이지를 선택해 SSR 을 수행하는 등으로 유연하게 설계`할 수 있습니다.  
그리고 SSG 를 사용함으로써 보다 뛰어난 성능의 웹 애플리케이션을 구현할 수 있습니다.

# p138, Next.js 의 페이지와 데이터 취득

| 종류 | 데이터 취득에 사용하는 주요 함수      | 데이터 취득 시점           | 보충 설명                                           |
| ---- | ------------------------------------- | -------------------------- | --------------------------------------------------- |
| SSG  | getStaticProps                        | 빌드 시(SSG)               | 데이터 취득을 전혀 수행하지 않는 경우도 SSG 에 해당 |
| SSR  | getServerSideProps                    | 사용자 요청 시(서버사이드) | getInitalProps 를 사용해도 SSR                      |
| ISR  | revalidate 를 반환하는 getStaticProps | 빌드 시(ISR)               | ISR 은 배포 후에도 백그라운드 빌드가 실행된다       |
| CSR  | 데이터 패칭 함수(axios, useSWR 등)    | 사용자 요청 시(브라우저)   | CSR 은 SSG/SSR/ISR 과 동시에 사용 가능              |

# p150, 링크

Next.js 에서는 애플리케이션 안의 다른 페이지로의 이동하기 위한 Link 컴포넌트가 있습니다.

Link 컴포넌트를 사용해 페이지를 이동한 경우는, 보통의 페이지 이동과 같이 이동 대상 페이지의 HTML 등을 얻어 화면에 그리는 것이 아니라,  
클라이언트 사이드에서 새로운 페이지를 그립니다.  
새로운 페이지를 그리기 위해 필요한 데이터는 미리 비동기 방식으로 얻습니다.  
그 덕분에 피이지를 재빨리 이동할 수 있습니다.

또한, router 객체의 push 메서드를 호출해서 페이지를 이동할 수도 있습니다.  
그 외에 router 객체에는 페이지 리로드를 수행하는 reload(), 페이지를 돌아가기 위한 back(), 페이지 이동 시작/종료 이벤트를 구독하는 메서드 등이 있습니다.

# p153, 이미지 표시

Next.js 에서 이미지를 표시할 때는 next/image 의 Image 컴포넌트를 사용합니다.  
img 태그가 아닌, Image 컴포넌트를 사용함으로써, 이미지를 읽을 때 서버 사이드에서 이미지를 최적화합니다.

Image 컴포넌트를 사용하면 브라우저의 정보를 기반으로 최적화된 이미지를 제공합니다.  
예를 들어, WebP 대응 브라우저에는 WebP 형식의 이미지를 제공하거나, 브라우저의 화면 크기에 맞춰 적절한 크기의 이미지를 제공하기도 합니다.

또한, 이미지를 그리는 방법 역시 몇 가지가 있습니다.  
Image 컴포넌트는 초기 단계에서 뷰포트에 표시되지 않는 이미지는 그리지 않고, 스크롤해서 뷰포트에서 가까워지는 단계에서 화면을 얻고 그리기 시작합니다.  
(이미지를 로딩하는 동안에는 이미지를 표시할 영역을 확보합니다. 이를 통해 이미지를 그린 전후로 레이아웃이 깨지는 것을 방지합니다.)

그 외에, Image 컴포넌트는 몇 가지 파라미터를 porps 에 전달할 수 있습니다.

## layout 에는 뷰포트의 변화에 따라 이미지를 리사이즈할 것인지를 설정할 수 있습니다.

기본값은 intrinsic 입니다.

- intrinsic 은 뷰표트가 이미지 크기보다 작을 때, 뷰포트에 맞춰 리사이즈한 이미지를 표시한다.
- responsive 는 뷰포트에 맞춰 리사이즈한 이미지를 표시한다.
- fixed 는 width 와 height 에 기반해, 뷰포트의 크기에 관계없이 같은 사이즈 이미지를 표시한다.
- fill 은 부모 요소에 맞춰서 이미지를 표시한다.

## placeholder 에서는 이미지 로딩 중에 표시할 내용을 지정할 수 있습니다.

empty 를 지정하면 이미지의 영역만 확보하고 아무것도 표시하지 않습니다.  
blur 를 지정하면 흐릿한 이미지를 표시합니다.  
import 문으로 읽은 로컬 이미지의 경우에는 흐릭한 이미지가 자동 생성되어 표시되지만, 경로로 지정한 경우나 외부 이미지의 경우는 blurDataURL 에 표시할 흐릿한 이미지의 URL을 지정해야 합니다.

`외부 리소스 이미지를 표시하는 경우에도 src 에 문자열 경로를 지정할 수 있습니다. 이때, 다음 2가지 사항을 주의해야 합니다.`  
첫 번째는 정적 파일과 달리 이미지 크기를 사전에 얻을 수 없기 때문에, layout 이 fill 이외인 경우에는 width 와 height 를 부여해 크기를 지정해야 합니다.  
두 번째는 외부 리소스 이미지를 표시하는 경우, 기본적으로는 최적화한 이미지를 표시할 수 없습니다. 따라서 next.config.js 의 domains 에 최적화를 허가하는 이미지의 도메인을 추가하거나, Image 컴포넌트의 unoptimized 에 true 를 전달해 최적화를 무효화해야 합니다.

# p159, 환경 변수/구성

Next.js 는 내부적으로 환경 변수를 위한 .env 파일을 처리할 수 있습니다.  
프로젝트 루트에 위치한 환경 변수 파일 .env 는 자동으로 로딩되어 코드상에서 참조할 수 있습니다.

.env 를 포함해 다음 형식의 파일을 참조할 수 있습니다.

- .env
- .env.local
- .env.${환경명}
- .env.${환경명}.local

.local 이 붙은 것은 .gitignore 에 추가되는 것을 의도한 것으로 API 키 등의 공개하고 싶지 않은 값을 저장하기 위해 사용합니다.

로딩된 환경 변수는 서버 사이드에서 실행하는 처리에서 참조할 수 있습니다.  
즉, getServerSideProps 등의 함수나 빌드 중 SSG 페이지를 그릴 때, SSR 를 서버 사이드에서 그릴 때 환경 변수의 값을 참조할 수 있습니다.  
(클라이언트에서 사용하려면 next.config.js 에서 주입 필요)

클라이언트 사이드에서도 접근하고 싶은 값에 대해서는 환경 변수 이름 앞에 NEXT*PUBLIC* 을 붙입니다.

# p167, 아토믹 디자인

# p170, 스타일드 컴포넌트를 Next.js에 도입 (\_document.tsx 수정내용 존재)

# p182, 스토리북을 사용한 컴포넌트 관리

# p191, 애드온 (스토리북 기능 확장방법)

# p213, 애플리케이션 개발 (실습!)

# p236, SWR 도입

# p455~ 로딩, 접근성, SEO, 보안
