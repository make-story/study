# 렌더링 방식 (Next.js 예시 포함)

https://leetrue-log.vercel.app/nextjs-12-rendering

# `타입스크립트, 리액트, Next.js 로 배우는 실전 웹애플리케이션 개발` 책 내용 중... - p132, Next.js 렌더링 방법

## 정적 사이트 생성 (SSG)

SSG에서는 빌드 시 API 등으로 부터 데이터를 얻어, 페이지를 그려 정적 파일로 생성합니다.

빌드 시 getSaticProps 라는 함수가 호출되며, 그 함수 안에서 API 호출 등을 수행하고, 페이지를 그리는 데 필요한 props 를 반환합니다.  
그 뒤, 이 props 를 페이지 컴포넌트에 전달해서 화면을 그립니다.  
화면을 그린 결과는 정적 파일의 형태로 빌드 결과로 저장합니다.  
페이지에 접근이 발생하면, 미리 생성한 정적파일을 클라이언트에 보내고, 브라우저는 그것을 기반으로 화면을 그립니다.  
브라우저에서 초기 화면을 그린 후에는 일반적인 리액트 애플리케이션과 마찬가지로, API 등으로 부터 데이터를 얻어 동적으로 화면을 그릴 수도 있습니다.

SSG 는 접근 시에는 정적 파일을 클라이언트에 전달할 뿐이므로 초기 화면 그리기가 빠릅니다.  
한편, 빌드시에만 데이터를 얻으므로 초기 화면을 그릴 때 오래된 데이터가 표시될 가능성이 있습니다.  
따라서 실시간성 콘텐츠에는 적합하지 않습니다.

빌드 후에 표시 내용이 업데이트되지 않는 페이지나 초기 화면 그리기 이후에 데이터를 표시할 수 있는 페이지에 SSG 가 적합합니다.  
성능이 뛰어나므로, Next.js 에서는 SSR 보다 SSG 를 권장합니다.  
(유성민 개인 생각: SSG 또는 SSR 모두 캐시 앳지서버를 활용하면 효과가 극대화 됨. 즉, 대고객에서는 캐시서버활용이 필수!)

## 클라이언트 사이드 렌더링 (CSR)

본래의 리액트 애플리케이션 흐름에 가까운 화면 그리기 방법입니다.  
페이지를 그리기 위해 필요한 데이터는 나중에 얻어서 반영하기 때문에, SEO 에는 그다지 유효하지 않습니다.

CSR 은 SSG, SSR, ISR 과 조합해서 사용됩니다. CSR 만 사용하는 것이 아니라 기본적으로는 SSG, SSR, ISR 과 조합한다고 생각하는 것이 좋습니다.

초기 화면을 그리는 것이 그렇게 중요하지 않고, 실시간성이 중요한 페이지에 적합합니다.

## 서버 사이드 렌더링 (SSR)

SSR 에서는 페이지 접근이 발생할 때마다 서버에서 getServerSideProps 를 호출하고,  
그 결과 props 를 기반으로 페이지를 서버 측에서 그려서 클라이어느에 전달합니다.

접근 시마다 서버에서 데이터를 얻어 화면을 그리기 때문에, 항상 최신 데이터를 기반으로 페이지 초기 화면을 그릴 수 있어, SEO 에 대한 유효성을 기대할 수 있습니다.  
하지만, 서버에서 어느 정도의 처리를 해야 하므로, 다른 방법에 비해 지연이 높아질 가능성이 있습니다.

최신 가격이 표시되는 제품 페이지 등, 항상 최신 데이터를 표시하고자 하는 경우에 적합합니다.

## 점진적 정적 재생성 (ISR)

ISR 은 SSG 의 응용이라 할 수 있는 렌더링 방법입니다.  
사전에 페이지를 생성해서 전송하면서, 동시에 접근이 발생함에 따라 페이지를 다시 생성해서 새로운 페이지를 전송할 수 있습니다.

페이지 접근이 발생하면 사전에 렌더링해서 서버에 저장한 페이지의 데이터를 클라이언트에 전달합니다.  
이 데이터에 유효 기간을 설정할 수 있으며, 유효 기간이 지난 상태에서 접근이 발생하면 백그라운드에서 다시 getStaticProps 를 실행해서 화면을 그리고, 서버에 저장된 페이지 데이터를 업데이트 합니다.

SSR 과 달리 요청 시 서버 측에서 처리를 하지 않으므로, SSG 와 마찬가지로 지연을 짧게 유지할 수 있고, 어느 정도 최신 데이터를 기반으로 하는 페이지를 초기에 그릴 수 있습니다.  
SSG 와 SSR 의 중간과 같은 렌더링 방법이라 할 수 있습니다.

---

# SSR, RSC

https://www.webscope.io/blog/server-components-vs-ssr

# Next.js pre-rendering 정리

https://nextjs.org/docs/basic-features/pages#pre-rendering

https://helloinyong.tistory.com/306

---

# 서버렌더링

> First Paint: 화면에 어떤 요소가 페인트된 시점  
> First Contentful Paint: 화면에 이미지나 텍스트가 나타난 시점  
> First Meaningful Paint: 화면에 사용자에게 의미있는 컨텐츠가 나타난 시점  
> Time To Interactive: 자바스크립트 초기 실행이 완료되고, 사용자가 인터렉션할 수 있는 시점

## 장점

- 검색엔진 SEO
- 초기 렌더링 성능(FMP)

## 단점

- 웹브라우저 보다(스크립트) 서버가 처리하는 일이 많아 지므로 서버 리소스가 사용된다는 단점
- 캐싱과 로드 밸런싱을 통해 성능 최적화 필수
- 프로젝트의 구조 복잡도 상승, 코드 스플리킹 등 고려사항 증가(서버 사이드 렌더링과 코드 스클리팅을 함께 적용하면 작업이 꽤 까다로움)

---

# JAM 스택

`모던 리액트 Deep Dive` 책 내용 중 - p257

프론트엔드는 자바스크립트와 마크업(HTML, CSS)을 미리 빌드해 두고 정적으로 사용자에게 제공  
이후 동작은 모두 사용자의 클라이언트에서 실행되므로 서버 확장성 문제에서 좀 더 자유로워질 수 있게 됐다.

(유성민 생각: JavaScript / HTML / CSS 빌드된 정적페이지 CDN 배포, 이를 사용)
