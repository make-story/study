# 쿠키
https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies  
https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Set-Cookie   

## 쿠키만들기  
`Set-Cookie` HTTP 응답 헤더는 서버로부터 사용자 에이전트로 전송됩니다.   
```
Set-Cookie: <cookie-name>=<cookie-value>
Set-Cookie: <cookie-name>=<cookie-value>; Expires=<date>
Set-Cookie: <cookie-name>=<cookie-value>; Max-Age=<non-zero-digit>
Set-Cookie: <cookie-name>=<cookie-value>; Domain=<domain-value>
Set-Cookie: <cookie-name>=<cookie-value>; Path=<path-value>
Set-Cookie: <cookie-name>=<cookie-value>; Secure
Set-Cookie: <cookie-name>=<cookie-value>; HttpOnly

Set-Cookie: <cookie-name>=<cookie-value>; SameSite=Strict
Set-Cookie: <cookie-name>=<cookie-value>; SameSite=Lax

// Multiple directives are also possible, for example:
Set-Cookie: <cookie-name>=<cookie-value>; Domain=<domain-value>; Secure; HttpOnly
```

### Expires=<date>
HTTP 타임스템프로 기록된 쿠키의 최대 생존 시간(수명)   

### Max-Age=<number>
쿠키가 만료될 때 까지의 시간 (초 단위)   
`브라우저들은 둘 다(Expires 와 Max-Age) 지정되었을 때 Max-Age 값을 더 우선`   

### Domain=<domain-value>
쿠키가 적용되어야 하는 호스트를 지정   
`서브 도메인을 포함하지 않습니다. 도메인이 지정되면, 서브도메인들은 항상 포함됩니다.`  
(만약 Domain=mozilla.org이 설정되면, 쿠키들은 developer.mozilla.org와 같은 서브도메인 상에 포함되게 됩니다.)  
만약 명시되지 않는다면, (서브 도메인은 포함되지 않는) 현재 문서 위치의 호스트 일부를 기본값으로 합니다. 도메인이 명시되면, 서브도메인들은 항상 포함됩니다.  

### Path=<path-value>
쿠키 헤더를 보내기 전에 요청 된 리소스에 있어야하는 URL 경로   

### Secure
보안 쿠키들은 서버에서 요청이 SSL을 사용하며, `HTTPS 프로토콜을 사용할 때에만 전송`   

### HttpOnly
HTTP-only cookies aren't accessible via JavaScript through the property   

### SameSite  
`서로 다른 도메인간의 쿠키 전송에 대한 보안을 설정`  
https://web.dev/i18n/ko/samesite-cookies-explained/  
현재 사이트의 도메인, 즉 브라우저의 주소 표시줄에 표시되는 도메인과 일치하는 쿠키를 `자사 쿠키`라고 합니다.  
마찬가지로 현재 사이트가 아닌 다른 도메인의 쿠키를 `타사 쿠키`라고 합니다. 
SameSite 특성(RFC6265bis에 정의됨)을 도입하면 `쿠키를 자사 또는 동일 사이트 컨텍스트로 제한해야 하는지 여부를 선언`할 수 있습니다.  

`20년 2월 4일 릴리즈된 구글 크롬(Google Chrome)80버전부터 새로운 쿠키 정책이 적용 되어 Cookie의  SameSite 속성의 기본값이 "None"에서 "Lax"로 변경되었습니다.`  

"None"은 동일 사이트과 크로스 사이트에 모두 쿠키 전송이 가능합니다.  
"Strict"로 설정할 경우 서로 다른 도메인에서는 아예 전송이 불가능해 지기 때문에 CSRF를 100% 방지할 수 있으나 사용자 편의성을 많이 해치게 됩니다. 그래서 Strict 설정에 일부  예외( HTTP get method / a href / link href )를 두어 적용되는 설정이 이번에 기본값으로 변경되는 "Lax" 입니다.   


-----


# document.cookie를 사용하여 JavaScript에서 해당 사이트에 사용할 수 있는 쿠키를 추가하고 읽을 수도 있음  
새로운 쿠키들은 Document.cookie를 사용해 만들어질 수도 있으며,  
HttpOnly 플래그가 설정되지 않은 경우 기본의 쿠키들은 자바스크립트로부터 잘 접근될 수 있습니다.   
```javascript
document.cookie = "yummy_cookie=choco";
document.cookie = "tasty_cookie=strawberry";
console.log(document.cookie);
// logs "yummy_cookie=choco; tasty_cookie=strawberry"
```


-----


## Secure과 HttpOnly
https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies#secure%EA%B3%BC_httponly_%EC%BF%A0%ED%82%A4  

`Secure 쿠키는 HTTPS 프로토콜 상에서 암호화된(encrypted) 요청일 경우에만 전송`됩니다.  
하지만 Secure일지라도 민감한 정보는 절대 쿠키에 저장되면 안됩니다. 
본질적으로 안전하지 않고 이 플래그가 당신에게 실질적인 보안(real protection)를 제공하지 않기 때문입니다.  
크롬52 혹은 파이어폭스52로 시작한다면, 안전하지 않은 사이트(http:)는 쿠키에 Secure 설정을 지시할 수 없습니다.  

Cross-site 스크립팅 (XSS (en-US)) 공격을 방지하기 위해, 
`HttpOnly 쿠키는 JavaScript의 Document.cookie API에 접근할 수 없습니다.` 그들은 서버에게 전송되기만 합니다.  
예를 들어, 서버 쪽에서 지속되고 있는 세션의 쿠키는 JavaScript를 사용할 필요성이 없기 때문에 HttpOnly 플래그가 설정될 것입니다.  


## Same Site 정책  
https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies#samesite_%EC%BF%A0%ED%82%A4_experimental_inline  
https://ifuwanna.tistory.com/223?fbclid=IwAR1oI81yEFZl6KaMkiZewLtYyHzIOXZU5OSVJigsRqjs-L5NFhSmFMPaJs4  


## 세션 하이재킹과 XSS
https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies#%EC%84%B8%EC%85%98_%ED%95%98%EC%9D%B4%EC%9E%AC%ED%82%B9%EA%B3%BC_xss  

XSS(교차 사이트 스크립팅)는 공격자가 웹 사이트에 악성 클라이언트 측 코드를 삽입할 수 있도록 하는 보안 악용  

쿠키는 대개 웹 애플리케이션에서 사용자와 그들의 인증된 세션을 식별하기 위해 사용되곤 합니다.  
그래서 쿠키를 가로채는 것은 인증된 사용자의 세션 하이재킹으로 이어질 수 있습니다.  
쿠키를 가로채는 일반적인 방법은 소셜 공학 사용 혹은 애플리케이션 내 XSS 취약점을 이용하는 것을 포함합니다.  


-----

