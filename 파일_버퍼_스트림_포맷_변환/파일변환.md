# íŒŒì¼ (File) / í¬ë§·

https://leetrue-log.vercel.app/file-convert

Fileê³¼ Blobì€ ëª¨ë‘ ì›¹ í”Œë«í¼ì—ì„œ íŒŒì¼ ë°ì´í„°ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê°ì²´ì…ë‹ˆë‹¤.

ì´ ë‘ ê°ì²´ëŠ” ìƒì† ê´€ê³„ì— ìˆìœ¼ë©°, Fileì€ Blobì˜ í™•ì¥ì…ë‹ˆë‹¤.  
Fileì€ Blobì„ ìƒì†í•˜ë¯€ë¡œ Blobì˜ ë©”ì„œë“œì™€ ì†ì„±ì„ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ë˜í•œ Fileì€ íŒŒì¼ê³¼ ê´€ë ¨ëœ ë©”íƒ€ë°ì´í„°ë¥¼ ì¶”ê°€ë¡œ í¬í•¨í•˜ê³  ìˆì–´ íŒŒì¼ì— ëŒ€í•œ ì •ë³´ë¥¼ ë”ìš± ì‰½ê²Œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Blob

Blob(Binary Large Object) ê°ì²´ëŠ” íŒŒì¼ë¥˜ì˜ ë¶ˆë³€í•˜ëŠ” ë¯¸ê°€ê³µ ë°ì´í„°

## File

íŒŒì¼ì— ëŒ€í•œ ì •ë³´ë¥¼ ì œê³µí•˜ê³ , ì›¹ í˜ì´ì§€ê°€ JavaScriptë¡œ íŒŒì¼ì˜ ë‚´ìš©ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µ

## URL

ì›¹ ë¦¬ì†ŒìŠ¤ì˜ ì£¼ì†Œë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë¬¸ìì—´  
createObjectURL() ì„ ì‚¬ìš©í•´ Blob ë˜ëŠ” File ê°ì²´ë¥¼ URL ë¡œ ë³€í™˜í•˜ë©´, ë³€í™˜ëœ URL ì€ í•´ë‹¹ ê°ì²´ë¥¼ ê°€ë¦¬í‚¤ëŠ” ìœ íš¨í•œ ì£¼ì†Œë¡œ ì‚¬ìš©ì´ ê°€ëŠ¥

### URL.createObjectURL

ì´ ë©”ì„œë“œëŠ” ì´ë¯¸ì§€ íŒŒì¼ì„ Blob ë˜ëŠ” File ê°ì²´ë¡œ ë³€í™˜í•˜ê³ ,  
ê·¸ ê°ì²´ë¥¼ URLë¡œ ë³€í™˜í•´ ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.  
ì´ ë°©ë²•ì€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì ê³  íš¨ìœ¨ì ì´ë‹¤.  
í•˜ì§€ë§Œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë¬¸ì œë¥¼ ìœ ë°œì‹œí‚¬ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, URL ì‚¬ìš©ì´ ì™„ë£Œë˜ë©´ URL.revokeObjectURLì„ í˜¸ì¶œí•˜ì—¬ ë©”ëª¨ë¦¬ë¥¼ í•´ì œí•´ì•¼í•œë‹¤.

## Buffer

Bufferí´ë˜ìŠ¤ëŠ” ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë“¤ì˜ ìŠ¤íŠ¸ë¦¼ì„ ì§ì ‘ ë‹¤ë£¨ê¸° ìœ„í•´ Node.js APIì— ì¶”ê°€

ì›í•˜ëŠ” í¬ê¸°ì˜ ë©”ëª¨ë¦¬ ê³µê°„ì„ í• ë‹¹ë°›ì•„ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” í´ë˜ìŠ¤  
ë°ì´í„°ë¥¼ 1Byteì”© ë‚˜ëˆ„ì–´ ì €ì¥í•œë‹¤.

## ArrayBuffer

ì¼ë ¨ì˜ ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê³ ì • í¬ê¸° ë²„í¼ë¡œ ì£¼ë¡œ ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê³  ë‹¤ë£¨ëŠ” ê²ƒì— ì‚¬ìš©  
ë°ì´í„°ë¥¼ ë‹¤ì–‘í•œ í˜•ì‹ìœ¼ë¡œ ì½ê³  ì“¸ ìˆ˜ ìˆëŠ” ë©”ëª¨ë¦¬ ë²„í¼ë¡œ ë™ì‘

## SharedArrayBuffer

https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer

SharedArrayBuffer ê°ì²´ëŠ” ì œë„¤ë¦­, ê³ ì •ëœ ê¸¸ì´ì˜ ì›ì‹œ ë°”ì´ë„ˆë¦¬ ë°ì´í„° ë²„í¼ë¥¼ í‘œí˜„í•˜ëŠ”ë° ì‚¬ìš©ë©ë‹ˆë‹¤.  
ArrayBuffer ê°ì²´ì™€ ìœ ì‚¬í•˜ì§€ë§Œ, ê³µìœ ëœ ë©”ëª¨ë¦¬ìƒì˜ ë·°ë¥¼ ìƒì„±í•˜ëŠ”ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ArrayBuffer ì™€ëŠ” ë‹¬ë¦¬, SharedArrayBuffer ëŠ” ë¶„ë¦¬ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

## Base64

Binary Data(8ë¹„íŠ¸ ì´ì§„ ë°ì´í„°)ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€ê²½í•˜ëŠ” ì¸ì½”ë”© ë°©ì‹ ì¤‘ í•˜ë‚˜ë¡œ ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ ë¬¸ì ì½”ë“œì— ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ” ê³µí†µ 64ê°œì˜ ASCII ì˜ì—­ì˜ ë¬¸ìë“¤ë¡œ ì´ë£¨ì–´ì§„ ë¬¸ìì—´ë¡œ ë³€ê²½

ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° (base64)

```javascript
// ì´ë¯¸ì§€ íŒŒì¼ ì„ íƒ - <input type="file" /> ì´ë¯¸ì§€ ì„ íƒë¨
function setImageFileBase64(event) {
  let self = event && event.currentTarget; // event listener element
  let target = event && (event.target || event.srcElement); // event ê°€ ë°œìƒí•œ element
  let files = self.files;

  // ì„ íƒ íŒŒì¼ ë¦¬ìŠ¤íŠ¸
  for (let i = 0, max = files.length; i < max; i++) {
    let reader = new FileReader();
    reader.readAsDataURL(files[i]); // base64
    reader.onload = e => {
      // e.target.result; // base64
    };
  }
}
```

---

https://github.com/kordobby/about-file/blob/main/src/App.tsx

```javascript
import { useEffect, useRef, useState } from "react";
import styled from "styled-components";

function App() {
  const [fileToUrl, setFileToUrl] = useState<string>("");
  const [blobToUrl, setBlobToUrl] = useState<string>("");
  const [blobToUrl2, setBlobToUrl2] = useState<string>("");
  const [fileToUrlWithReader, setFileToUrlWithReader] = useState<string>("");
  const [bufferToUrl, setBufferToUrl] = useState<string>("");

  const [canvasImg, setCanvasImg] = useState<string>("");
  const canvasRef = useRef<HTMLCanvasElement>(null);

  /* 1ï¸âƒ£ íŒŒì¼ ê°€ì ¸ì˜¤ê¸° */
  const handleFile = (event: React.ChangeEvent<HTMLInputElement>) => {
    const getFileList = event.target.files;
    console.log("1ï¸âƒ£ FileList", getFileList);
    if (getFileList) {
      console.log("1ï¸âƒ£ File", getFileList[0]);

      /* 2ï¸âƒ£ File To Blob */
      const file: File = getFileList[0];
      const blob: Blob = file;
      console.log("2ï¸âƒ£ File", getFileList[0]);
      console.log("2ï¸âƒ£ Blob ğŸ‘‰ğŸ»", blob);

      /* 3ï¸âƒ£ Blob To File */
      const fileName = file.name;
      const fileType = file.type;
      const BlobToFile = new File([blob], fileName, {
        type: fileType,
      });
      console.log("3ï¸âƒ£ BlobToFile", BlobToFile);

      const modifiedFileName = "lxxtrue.png";
      const modifiedFileType = "image/png";
      const BlobToFileModified = new File([blob], modifiedFileName, {
        type: modifiedFileType,
      });
      console.log("3ï¸âƒ£ BlobToFileModified", BlobToFileModified);

      /* 4ï¸âƒ£ File & Blob to URL */
      const FileToUrl = window.URL.createObjectURL(file);
      const BlobToUrl = window.URL.createObjectURL(blob);
      console.log("4ï¸âƒ£ FileToUrl", FileToUrl);
      console.log("4ï¸âƒ£ BlobToUrl ğŸ‘‰ğŸ»", BlobToUrl);
      setFileToUrl(FileToUrl);
      setBlobToUrl(BlobToUrl);

      /* 5ï¸âƒ£Â File & Blob to URL With FileReader */
      const fileToUrlWithFileReader = (file: File) => {
        const reader = new FileReader();
        reader.onloadend = function (finishedEvent: ProgressEvent<FileReader>) {
          const { target } = finishedEvent;
          if (target && target.result) {
            console.log("5ï¸âƒ£Â File & Blob to URL With FileReader", target.result);
            if (typeof target.result === "string") {
              setFileToUrlWithReader(target.result);
            }
          }
        };
        reader.readAsDataURL(file); // TYPE :: base64
      };
      fileToUrlWithFileReader(file);

      /* 6ï¸âƒ£Â URL To Blob */
      const getUrlToBlob = async (url: string) => {
        const response = await fetch(url);
        const UrlToBlob = await response.blob();
        const BlobToUrl = window.URL.createObjectURL(UrlToBlob);
        console.log("6ï¸âƒ£Â UrlToBlob ğŸ‘‰ğŸ»", UrlToBlob);
        console.log("6ï¸âƒ£Â BlobToUrl ğŸ‘‰ğŸ»", BlobToUrl);
        setBlobToUrl2(BlobToUrl);
      };
      getUrlToBlob(BlobToUrl);

      /* 7ï¸âƒ£Â URL with FileReader to Blob */
      const urlWithFileReaderToBlob = (file: File) => {
        const reader = new FileReader();
        reader.onloadend = function (finishedEvent: ProgressEvent<FileReader>) {
          const { target } = finishedEvent;
          if (target && target.result) {
            if (typeof target.result === "string") {
              setFileToUrlWithReader(target.result);
              const UrlWithFileReaderToBlob = new Blob([target.result], {
                type: "image/jpeg",
              });
              console.log(
                "7ï¸âƒ£Â URL with FileReader to Blob",
                UrlWithFileReaderToBlob
              );
            }
          }
        };
        reader.readAsDataURL(file); // TYPE :: base64
      };
      urlWithFileReaderToBlob(file);

      /* 8ï¸âƒ£Â File & Blob to ArrayBuffer */
      const fileToArrayBufferWithFileReader = (file: File) => {
        const reader = new FileReader();
        reader.onloadend = function (finishedEvent: ProgressEvent<FileReader>) {
          const { target } = finishedEvent;
          if (target && target.result) {
            console.log("8ï¸âƒ£Â File & Blob to ArrayBuffer", target.result);
          }
        };
        reader.readAsArrayBuffer(file);
      };
      fileToArrayBufferWithFileReader(file);

      /* 9ï¸âƒ£Â URL to ArrayBuffer */
      const urlToArrayBuffer = async (url: string) => {
        try {
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          const arrayBuffer = await response.arrayBuffer();
          console.log("9ï¸âƒ£Â URL to ArrayBuffer", arrayBuffer);
          return arrayBuffer;
        } catch (error) {
          console.log("ğŸš¨ ERROR", error);
          return null;
        }
      };

      urlToArrayBuffer(FileToUrl);

      /* Base64 to ArrayBuffer  */
      const base64ToArrayBuffer = (base64, contentType) => {
        contentType = contentType || base64.match(/^data\:([^\;]+)\;base64,/mi)[1] || ''; // e.g. 'data:image/jpeg;base64,...' => 'image/jpeg'
        base64 = base64.replace(/^data\:([^\;]+)\;base64,/gmi, '');
        const binary = atob(base64);
        const len = binary.length;
        const buffer = new ArrayBuffer(len);
        const view = new Uint8Array(buffer);
        for (let i = 0; i < len; i++) {
            view[i] = binary.charCodeAt(i);
        }
        return buffer;
    };

      /* ğŸ”ŸÂ ArrayBuffer to Blob */
      const arrayBufferToBlobToUrl = (file: File) => {
        const reader = new FileReader();
        reader.onloadend = function (finishedEvent: ProgressEvent<FileReader>) {
          const { target } = finishedEvent;
          if (target && target.result) {
            const arrayBuffer = target.result as ArrayBuffer;
            const bufferToBlob = new Blob([arrayBuffer], {
              type: file.type,
            });
            const bufferToBlobToURL = URL.createObjectURL(bufferToBlob);
            console.log("ğŸ”ŸÂ ArrayBuffer to Blob", bufferToBlob);
            console.log("ğŸ”ŸÂ ArrayBuffer to Blob to URL", bufferToBlobToURL);
            setBufferToUrl(bufferToBlobToURL);
          }
        };
        reader.readAsArrayBuffer(file);
      };
      arrayBufferToBlobToUrl(file);

      /* URL to Blob  */
      const objectURLToBlob = (url, callback) => {
        var http = new XMLHttpRequest();
        http.open("GET", url, true);
        http.responseType = "blob";
        http.onload = function(e) {
            if (this.status == 200 || this.status === 0) {
                callback(this.response);
            }
        };
        http.send();
    };

      /* ğŸ¨Â Make Preview with canvas */
      const getPreviewImgWithCanvas = (file: File) => {
        const reader = new FileReader();
        reader.onloadend = function (finishedEvent: ProgressEvent<FileReader>) {
          const { target } = finishedEvent;
          if (target && target.result) {
            const image = new Image();
            image.onload = () => {
              const canvas = canvasRef.current;
              if (canvas) {
                // âœ… getContxt() ë©”ì„œë“œë¥¼ í†µí•´ CanvasRenderingContext2D êµ¬í•˜ê¸°
                const context = canvas.getContext("2d");
                if (context) {
                  // âœ… clearRect() => íŠ¹ì • ë¶€ë¶„ì„ ì§€ìš´ ì§ì‚¬ê°í˜• ê·¸ë¦¬ê¸°
                  context.clearRect(0, 0, canvas.width, canvas.height);
                  // âœ… drawImage() => ìº”ë²„ìŠ¤ì—ì„œ ì´ë¯¸ì§€ë¥¼ ê·¸ë ¤ì¤Œ
                  context.drawImage(image, 0, 0, canvas.width, canvas.height);
                  // âœ… toDataURL(type, quality) => url ì¶”ì¶œ (ìµœê³  í€„ë¦¬í‹°, ë‘ë²ˆì§¸ ì¸ì ìˆ«ìê°€ ë‚®ì„ ìˆ˜ë¡ ë‚®ì€ í€„ë¦¬í‹°)
                  const imageUrl = canvas.toDataURL("image/png", 1.0);
                  setCanvasImg(imageUrl);
                }
              }
            };
            image.src = reader.result as string;
          }
        };
        reader.readAsDataURL(file);
      };
      getPreviewImgWithCanvas(file);
    }
  };

  useEffect(() => {
    const canvas = canvasRef.current;
    if (canvas) {
      canvas.width = 200;
      canvas.height = 200;
    }
  }, []);

  return (
    <Layout>
      <Input type="file" id="imgFile" onChange={handleFile} />
      <SectionBox>
        <Section>
          <p>File ì„ URLë¡œ ë³€í™˜</p>
          <PreviewImage src={fileToUrl} alt="file-to-url" />
        </Section>
        <Section>
          <p>Blob ì„ URLë¡œ ë³€í™˜</p>
          <PreviewImage src={blobToUrl} alt="blob-to-url" />
        </Section>
        <Section>
          <p>Blob ì„ URLë¡œ ë³€í™˜í•œê±¸ í•œë°”í€´ ë‹¤ì‹œ ëŒë¦¼</p>
          <PreviewImage src={blobToUrl2} alt="blob-to-url" />
        </Section>
        <Section>
          <p>FileReader ë¡œ ë³€í™˜í•œ URL</p>
          <PreviewImage src={fileToUrlWithReader} alt="blob-to-url" />
        </Section>
        <Section>
          <p>Buffer ë¥¼ URLë¡œ ë³€í™˜</p>
          <PreviewImage src={bufferToUrl} alt="blob-to-url" />
        </Section>
        <Section>
          <p>canvas ë¯¸ë¦¬ë³´ê¸°</p>
          <PreviewImage src={canvasImg} alt="canvas-img" />
          <canvas ref={canvasRef} style={{ display: "none" }} />
        </Section>
      </SectionBox>
    </Layout>
  );
}

export default App;

const Layout = styled.section`
  padding: 30px;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  height: 100vh;
`;

const SectionBox = styled.div`
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  width: 600px;
`;
const Section = styled.div`
  border: 1px solid gray;
  border-radius: 10px;
  padding: 0px 20px;
  margin-top: 10px;
`;
const Input = styled.input``;

const PreviewImage = styled.img`
  width: 200px;
  height: 200px;
`;
```
